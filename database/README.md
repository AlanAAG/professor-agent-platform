# Database Setup: Supabase Vector Store

This project uses **Supabase** (PostgreSQL with the `pgvector` extension) as its primary knowledge base. The database stores the highly-processed, cleaned, and chunked course material in vector embeddings, which allows the AI tutor to perform fast, semantic searches (RAG).

## 1. Required Extensions

For the system to function, the following extension must be enabled in your Supabase project (via the SQL Editor or Extensions tab):

-   **`vector`**: Enables the PostgreSQL database to store and query vector embeddings efficiently.

## 2. Main Table Schema

All course chunks are stored in a single table, `documents`.

| Column Name | Type | Purpose |
| :--- | :--- | :--- |
| `id` | `UUID` | Primary key, automatically generated. |
| `content` | `TEXT` | The clean, chunked text content (e.g., a paragraph from a lecture). |
| `metadata` | `JSONB` | Stores flexible, structured data about the source (class name, URL, page number, section, title). |
| `embedding` | `VECTOR(768)` | The vector representation of `content` generated by the **Gemini Embedding Model**. (Dimensionality must be 768). |
| `created_at`| `TIMESTAMP`| Timestamp of when the chunk was inserted. |

## 3. Performance Optimization (Indexes)

To ensure the API is fast, especially when filtering by class name or checking for duplicates, the following indexes are essential. These are run via `add_indexes.sql`.

1.  **Metadata Class Index:** Speeds up filtering queries based on `metadata->>'class_name'`.
2.  **Metadata URL Index:** Speeds up checking if a resource (`metadata->>'source_url'`) has already been processed (de-duplication).

**NOTE:** These indexes must be run outside of a transaction block using `CREATE INDEX CONCURRENTLY` in the Supabase SQL Editor.